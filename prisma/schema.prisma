generator client {
  provider = "prisma-client-js"
}

// // // For development
// datasource db {
//   provider = "postgresql"
//   url      = env("DATABASE_URL")
// }

// For production
datasource db {
  provider          = "postgresql"
  url               = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl         = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
  shadowDatabaseUrl = env("POSTGRES_URL_NON_POOLING") // used for migrations
}

// ok
enum ProductStatus {
  AVAILABLE
  LOW_STOCK
  OUT_OF_STOCK
  ARCHIVED
}

// ok
model Product {
  id                   String                 @id @default(uuid())
  title                String
  image                String
  description          String
  showing_instruction  String
  bloom_size           String
  type_id              String
  color_id             String
  family_id            String
  cost_price           Float
  selling_price        Float
  inventory            Int
  sku                  Int
  discount_id          String?
  admin_id             String //
  status               ProductStatus          @default(OUT_OF_STOCK)
  create_at            DateTime
  modified_at          DateTime?
  deleted_at           DateTime?
  category             Category[]
  Flower_Family        Flower_Family          @relation(fields: [family_id], references: [id])
  Seasonal_Information Seasonal_Information[]
  Flower_Color         Flower_Color           @relation(fields: [color_id], references: [id])
  Flower_Type          Flower_Type            @relation(fields: [type_id], references: [id])
  Discount             Discount?              @relation(fields: [discount_id], references: [id])
  Product_Review       Product_Review[]
  Order_Item           Order_Item[]
  Admin_User           Admin_User             @relation(fields: [admin_id], references: [id])
}

// ok
model Category {
  id          String    @id @default(uuid())
  name        String
  description String
  create_at   DateTime
  modified_at DateTime?
  deleted_at  DateTime?
  Product     Product[]
}

// ok
model Flower_Family {
  id          String    @id @default(uuid())
  name        String
  description String?
  create_at   DateTime
  modified_at DateTime?
  deleted_at  DateTime?
  Product     Product[]
}

// ok
model Seasonal_Information {
  id          String    @id @default(uuid())
  name        String
  description String?
  create_at   DateTime
  modified_at DateTime?
  deleted_at  DateTime?
  Product     Product[]
}

// ok
model Flower_Type {
  id          String    @id @default(uuid())
  name        String
  description String?
  create_at   DateTime
  modified_at DateTime?
  deleted_at  DateTime?
  Product     Product[]
}

// ok
model Flower_Color {
  id          String    @id @default(uuid())
  name        String
  description String?
  create_at   DateTime
  modified_at DateTime?
  deleted_at  DateTime?
  Product     Product[]
}

// ok
enum Discount_Status {
  ACTIVE
  INACTIVE
}

// ok
model Discount {
  id               String          @id @default(uuid())
  name             String
  description      String?
  discount_precent Float
  status           Discount_Status @default(INACTIVE)
  create_at        DateTime
  modified_at      DateTime?
  deleted_at       DateTime?
  Product          Product[]
}

// ok
model Product_Review {
  id           String    @id @default(uuid())
  product_id   String?
  title        String
  rating       Int
  content      String?
  published_on DateTime
  deleted_at   DateTime?

  Product Product? @relation(fields: [product_id], references: [id])
}

// ok
enum Acc_status {
  ACTIVE
  SUSPENDED
  DELETED
}

// ok
model User {
  id            String     @id @default(cuid())
  email         String?    @unique
  emailVerified DateTime?
  image         String?
  first_name    String
  last_name     String
  password      String
  telephone     String
  dob           DateTime
  register_on   DateTime
  last_login    DateTime?
  acc_status    Acc_status @default(ACTIVE)
  modified_at   DateTime?
  deleted_at    DateTime?

  accounts      Account[]
  sessions      Session[]
  User_Payment  User_Payment[]
  Address       Address[]
  Order_details Order_details[]
  UserImage     UserImage[]
}

model UserImage {
  id     String  @id @default(cuid())
  image  String?
  user   User?   @relation(fields: [userId], references: [id])
  userId String?
}

// ok
model User_Payment {
  id           String    @id @default(uuid())
  user_id      String
  card_type    String
  provider     String
  name_on_card String
  card_number  String
  cvv          String
  card_expiry  DateTime
  create_at    DateTime
  modified_at  DateTime?
  deleted_at   DateTime?

  User User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  Order_Transaction Order_Transaction[]
}

// ok
enum CardType {
  CREDIT
  DEBIT
}

// ok
enum OrderTransactionStatus {
  CANCELED
  FAILED
  PENDING
  REJECTED
  DECLINED
  SUCCESSFUL
}

// ok
model Order_Transaction {
  id          String                 @id @default(uuid())
  order_id    String
  payment_id  String
  type        CardType
  amount      Float
  status      OrderTransactionStatus
  create_at   DateTime
  modified_at DateTime?

  Order        Order_details @relation(fields: [order_id], references: [id])
  User_Payment User_Payment  @relation(fields: [payment_id], references: [id])
}

// ok
model Shipping {
  id                       String          @id @default(uuid())
  shipping_method          String
  courier_service_provider String
  shipping_cost            Float
  create_at                DateTime
  modified_at              DateTime?
  deleted_at               DateTime?
  Order_details            Order_details[]
}

// ok
model Address {
  id            String    @id @default(uuid())
  user_id       String
  address_line1 String
  address_line2 String?
  subDistrict   String
  district      String
  province      String
  zipcode       String
  create_at     DateTime
  modified_at   DateTime?
  deleted_at    DateTime?

  User          User            @relation(fields: [user_id], references: [id], onDelete: Cascade)
  Order_details Order_details[]
}

// ok
model Order_Status {
  id            String         @id @default(uuid())
  status        StatusType     @unique @default(PENDING)
  description   String?
  create_at     DateTime
  modified_at   DateTime?
  Order_details Order_details?
}

// ok
model Order_Item {
  id          String    @id @default(uuid())
  order_id    String
  product_id  String?
  price       Float
  discount    Float?
  quantity    Int
  create_at   DateTime
  modified_at DateTime?

  Order   Order_details @relation(fields: [order_id], references: [id])
  Product Product?      @relation(fields: [product_id], references: [id])
}

// ok
enum StatusType {
  CANCELED
  PENDING
  REJECTED
  DELIVERED
}

// ok
model Order_details {
  id              String    @id @default(uuid())
  user_id         String
  status_id       String    @unique
  subtotal_amount Float
  product_discout Float
  tax_amount      Int
  shipping_id     String
  shipping_date   DateTime
  address_id      String
  total_amount    Float
  create_at       DateTime
  modified_at     DateTime?
  admin_UserId    String    @unique

  Status            Order_Status        @relation(fields: [status_id], references: [id])
  User              User                @relation(fields: [user_id], references: [id])
  shipping          Shipping            @relation(fields: [shipping_id], references: [id])
  Address           Address             @relation(fields: [address_id], references: [id])
  Order_Item        Order_Item[]
  Order_Transaction Order_Transaction[]
}

// ok
enum AdminType {
  admin
  manager
  staff
}

// ok
model Admin_Type {
  id          String       @id @default(uuid())
  type        AdminType    @unique @default(staff)
  permission  String
  create_at   DateTime
  modified_at DateTime?
  Admin_User  Admin_User[]
}

// ok
model Admin_User {
  id            String    @id @default(uuid())
  usernames     String    @unique
  password      String
  first_name    String
  last_name     String
  last_login    DateTime
  create_at     DateTime
  modified_at   DateTime?
  deleted_at    DateTime?
  admin_type_id String?
  Product       Product[]

  AdminType Admin_Type? @relation(fields: [admin_type_id], references: [id])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
